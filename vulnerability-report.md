# Vulnerability Report

### Vulnerability 1: A2 Weak Account Management
#### Exposure
Our store does not protect against brute force attacks. This allows users to maliciously 
flood our data with inputs through registration, login, or searches.

#### Repair
One fix to this would be to throttle requests as shown below:
```
   [AllowXRequestsEveryXSecondsAttribute(Name = "LogOn", 
Message = "You have performed this action more than {x}
 times in the last {n} seconds.", Requests = 3, Seconds
 = 60)]
```

#### Resources
https://www.owasp.org/index.php/.NET_Security_Cheat_Sheet

### Vulnerability 2: A4 Insecure Direct object references
#### Exposure:
Even though it doesn't seem to be an issue with our website, there appears to not be any
 check to ensure that the ID of the current user matches that of the basket item to update.

#### Repair:
This can be remedied through the following code:
```
public async Task<IActionResult> Update([Bind("ID, ProductID, ProductName, 
CustomerEmail, Quantity, ImgUrl, Description, UnitPrice")]BasketItem basketItem)
{
    if (user.Identity.Name != basketItem.CustomerEmail)
        return RedirectToAction(nameof(Index));
}
```

#### Resources
https://www.owasp.org/index.php/.NET_Security_Cheat_Sheet

### Forms authentication
#### Exposure:
We did not reduce the forms authentication timeout from the default value of 20 minutes. 
ASP.NET does not appear to have any built-in methods to do so. 

#### Repair:
One way to implement timeouts is through JavaScript:
```
$(function() {
   var _redirectTimeout = 15*1000; // fifteen minute timeout
   var _redirectUrl = '/Account/Login'; // login URL

   var _redirectHandle = null;

   function resetRedirect() {
       if (_redirectHandle) clearTimeout(_redirectHandle);
       _redirectHandle = setTimeout(function() { window.location.href = _redirectUrl; }, _redirectTimeout);
   }

   $.ajaxSetup({complete: function() { resetRedirect(); } }); // reset idle redirect when an AJAX request completes

   resetRedirect(); // start idle redirect timer initially.
});
```

This takes the user to the login page after being inactive for 15 minutes.

#### Resources
https://stackoverflow.com/questions/12902194/asp-net-forms-authentication-timeout
https://www.owasp.org/index.php/.NET_Security_Cheat_Sheet

### A3 Cross Site Scripting
We did not install the Microsoft AntiXSS library. This could have been fixed by the following install:
```Install-Package AntiXSS```

Then in a config include the following:
```
  <system.web>
       <httpRuntime targetFramework="4.5" enableVersionHeader="false" encoderType="Microsoft.Security.Application.AntiXssEncoder, AntiXssLibrary" maxRequestLength="4096" />
```

Additionally, a content security policy should be added such as the following:
```
<system.webServer>
       <httpProtocol>
           <customHeaders>
               <add name="Content-Security-Policy" value="default-src 'none'; style-src 'self'; img-src 'self'; font-src 'self'; script-src 'self'" />
               ...
```

This prevents pages from accessing assets that it shouldn't be able to access.

#### Resources
https://www.owasp.org/index.php/.NET_Security_Cheat_Sheet